function Painter(t,e,i){this.canvas=document.getElementById(t),this.canvas.getContext&&(this.ctx=this.canvas.getContext("2d"),this.data=i,this.paintImplement=e,this.width=this.canvas.width,this.height=this.canvas.height)}function xAxis(t){this.options=t}function yAxis(t){this.scalerOptions=t}function calcAxisValues(t,e,i,n){var o=(t-e)/(i-1),s=[];void 0===n&&(n=toMoney);for(var r=0;r<i;r++)s.push(toMoney(t-r*o));return s}function disableBubbleAndPreventDefault(t){t.preventDefault&&t.preventDefault(),t.cancelBubble=!0}function setTouchEventOffsetPosition(t,e){(t=t||event).touches&&t.touches.length?t=t.touches[0]:t.changedTouches&&t.changedTouches.length&&(t=t.changedTouches[0]);var i,n;return i=t.pageX-e.x,n=t.pageY-e.y,{offsetX:i,offsetY:n}}function crossLinesAndTipMgr(t,e){"function"!=typeof Tip&&(window.Tip=function(){},window.Tip.prototype={show:function(){},hide:function(){},update:function(){}}),this.canvas=t,this.options=e}function addCrossLinesAndTipEvents(t,e){t.crossLineAndTipMgrInstance||(t.crossLineAndTipMgrInstance=new crossLinesAndTipMgr(t,e),t.crossLineAndTipMgrInstance.addCrossLinesAndTipEvents())}function controller(t,e){this.canvas=$id(t),this.ctx=this.canvas.getContext("2d"),this.region=e.region,this.bar=e.bar,this.value=e.value,this.minBarDistance=e.minBarDistance||5,this.onPositionChanged=e.onPositionChanged,this.prePaint=e.prePaint,this.isTouchDevice=isTouchDevice(),this.touchFaultTolerance=e.touchFaultTolerance}function crossLines(t){this.updateOptions(t)}function linePainter(t){this.options=t}function loading(t,e){this.canvas="String"==typeof t?document.getElementById(t):t,e?(this.radius=e.radius||10,this.circleLineWidth=e.circleLineWidth||4,this.circleColor=e.circleColor||"lightgray",this.dotColor=e.dotColor||"gray"):(this.radius=10,this.circelLineWidth=4,this.circleColor="lightgray",this.dotColor="gray")}function Tip(t){extendObject(t,this)}function volumePainter(t){this.options=t,this.barWidth=t.bar.width,this.spaceWidth=t.region.width/t.maxDotsCount-t.bar.width,this.spaceWidth<1&&(this.spaceWidth=0),this.barWidth*t.maxDotsCount>t.region.width&&(this.barWidth=t.region.width/t.maxDotsCount)}function disableBubbleAndPreventDefault(t){t.preventDefault&&t.preventDefault(),t.cancelBubble=!0}function setTouchEventOffsetPosition(t,e){(t=t||event).touches&&t.touches.length?t=t.touches[0]:t.changedTouches&&t.changedTouches.length&&(t=t.changedTouches[0]);var i,n;return i=t.pageX-e.x,n=t.pageY-e.y,{offsetX:i,offsetY:n}}function _crossLinesAndTipMgr(t,e){"function"!=typeof Tip&&(window.Tip=function(){},window.Tip.prototype={show:function(){},hide:function(){},update:function(){}}),this.canvas=t,this.options=e}function _addCrossLinesAndTipEvents(t,e){t.crossLineAndTipMgrInstance||(t.crossLineAndTipMgrInstance=new _crossLinesAndTipMgr(t,e),t.crossLineAndTipMgrInstance.addCrossLinesAndTipEvents())}function getKLData(t,e){t=t||"1day",Ajax.get("/stork/get.php?k="+t,function(t){t=JSON.parse(t.response);for(var i={},n=[],o=0;o<t.length;o++){var s=t[o],r={quoteTime:s[0],preClose:s[1],open:s[2],high:s[3],low:s[4],close:s[5],volume:s[6],amount:s[7]};0==n.length?(i.low=r.low,i.high=r.high):(i.high=Math.max(i.high,r.high),i.low=Math.min(i.low,r.low)),n.push(r)}drawKL(),i.ks=n,e(i)},"canvasKL",!0)}function getFSData(t,e){Ajax.get("/stork/get.php?k=fs",function(t){t=JSON.parse(t.response),e(t)},"canvasKL",!0)}function select(t){switch(t){case 0:painter=null,kType="fs",showChart("canvasFS");break;case 1:painter=null,kType="1day",drawKL();break;case 2:painter=null,kType="7day",drawKL();break;case 3:painter=null,kType="30day",drawKL()}}function convertDate(t,e){var i=Math.ceil(t/1e4)-1,n=t%100,o=(Math.ceil(t/100)-1)%100,s=(t.toString().substr(8,2),new Date);return s.setYear(i),s.setMonth(o-1),s.setDate(n),o<10&&(o="0"+o),n<10&&(n="0"+n),e?i+"-"+o+"-"+n+"(星期"+["日","一","二","三","四","五","六"][s.getDay()]+")":t.toString().length>8?void 0:i+"-"+o+"-"+n}function calcMAPrices(t,e,i,n){for(var o=new Array,s=e;s<e+i;s++){var r=s-n+1;if(r<0)o.push(!1);else{for(var a=0,h=r;h<=s;h++)a+=t[h].close;var l=a/n;o.push(l)}}return o}function kLine(t){this.options=t,this.dataRanges=null}function drawKL(t){document.getElementById("chartLoading").style.display="none";var e=document.getElementById("canvasFS");e&&e.remove(),t||(document.getElementById("storeWarp").style.display="block",document.querySelector("#canvasKL").remove(),(n=document.createElement("canvas")).id="canvasKL",n.width="984",n.height="250",n.style="z-index: 2; border: 1px solid #69c",document.querySelector("#storeWarp").appendChild(n));var i={backgroundColor:"#fff",riseColor:"#F11200",fallColor:"#00A800",normalColor:"#EEEEEE",chartMargin:{left:45.5,top:20.5,right:20.5},region:{x:0,y:0,width:initialWidth,height:160},barWidth:5,spaceWidth:2,horizontalLineCount:3,verticalLineCount:2,lineStyle:"dashed",borderColor:"gray",splitLineColor:"#eeeeee",lineWidth:1,MAs:[{color:"#FDADC4",daysCount:5},{color:"#22C1DB",daysCount:10},{color:"#EE3073",daysCount:20},{color:"#8FBD13",daysCount:60}],yAxis:{font:"11px Arial",color:"black",align:"right",fontHeight:8,textBaseline:"top"},xAxis:{font:"11px Arial",color:"black",align:"right",fontHeight:8,textBaseline:"top",scalerCount:4},volume:{region:{x:0,y:180.5,height:40,width:initialWidth},horizontalLineCount:1,yAxis:{font:"11px Arial",color:"black",align:"right",fontHeight:8,textBaseline:"top"}},priceLine:{region:{x:45.5,y:380.5,height:60,width:initialWidth-45.5-20.5},verticalLineCount:7,horizontalLineCount:1,lineStyle:"dashed",borderColor:"gray",splitLineColor:"#eeeeee",fillColor:"lightgray",alpha:.5,yAxis:{font:"11px Arial",color:"black",align:"right",fontHeight:8,textBaseline:"top"}},controller:{bar:{width:20,height:35,borderColor:"black",fillColor:"lightgray"},minBarDistance:20}};if(painter)painter&&1!=painter&&(painter.dataRanges=t,painter.paint());else{var n=$id("canvasKL");n.width!=initialWidth&&(n.width=initialWidth);var o=new kLine(i);painter=1,getKLData(kType,function(t){(painter=new Painter("canvasKL",o,t)).paint()})}}function line(t,e,i,n,o,s,r){t.beginPath(),t.moveTo(e,i),t.lineTo(n,o),t.strokeStyle=s,t.lineWidth=r||1,t.stroke()}function getMinTime(t){var e=new Date;t<=120?(e.setHours(9,30,30),e=new Date(e.getTime()+60*t*1e3)):(e.setHours(13,0,0),e=new Date(e.getTime()+60*(t-120)*1e3));return(e.getHours()>9?new String(e.getHours()):"0"+e.getHours())+""+(e.getMinutes()>9?new String(e.getMinutes()):"0"+e.getMinutes())+"30"}function _Tip(t){this.options=t,this.canvas=t.canvas,this.canvas.tip=this}function minsChart(t,e){extendObject(e,this),this.canvas=$id(t),this.ctx=this.canvas.getContext("2d"),this.canvas.painter=this,this.options=e,this.initWidth(e)}function showChart(t){var e=document.getElementById("canvasFS");e&&e.remove(),(e=document.createElement("canvas")).id="canvasFS",e.width=414,e.height=250,document.getElementById("fsWarp").appendChild(e),document.getElementById("storeWarp").style.display="none",document.getElementById("chartLoading").style.display="none",window.chart||(chart=new minsChart(t,newCharConfig)),getFSData(kType,function(t){window.fsdata=t,document.getElementById("fsWarp").style.display="block",fsdata.mins.push({price:2240.16,volume:21086600,amount:193157609}),newCharConfig.maxDotsCount=fsdata.mins.length,chart.paint(fsdata)}.bind(window))}var dashSize=2;Painter.prototype={paint:function(t){var e=this.paintImplement;this.data,this.ctx;if("function"==typeof e.initialize&&e.initialize(this),e.start&&e.start.call(this),"function"==typeof e.paintItems)e.paintItems.call(this);else{var i="function"==typeof e.getDataLength?e.getDataLength.call(this):this.data.length,n={x:0,y:0},o={x:0,y:0};t&&(o.y=t.region.height);for(var s=0;s<i;s++){var r=e.getX?e.getX.call(this,s):void 0,a=e.getY?e.getY.call(this,s):void 0;0==s&&(n.x=r),s==i-1&&(o.x=r),e.paintItem.call(this,s,r,a,!0)}e.paintItemForBg&&e.paintItemForBg.call&&e.paintItemForBg.call(this,n,o,!0)}e.end&&e.end.call(this)},drawHLine:function(t,e,i,n,o,s){var r=this.ctx;if(r.strokeStyle=t,10*i%10==0&&(i+=.5),s&&"dashed"==s){var a=0;do{this.drawHLine(t,a,i,dashSize,1,"solid"),a+=2*dashSize}while(a<n)}else r.beginPath(),r.moveTo(e,i),r.lineTo(e+n,i),r.stroke()},drawVLine:function(t,e,i,n,o,s){var r=this.ctx;if(r.strokeStyle=t,10*e%10==0&&(e+=.5),s&&"dashed"==s){var a=0;do{this.drawVLine(t,e,a,dashSize,1),a+=2*dashSize}while(a<n)}else r.beginPath(),r.moveTo(e,i),r.lineTo(e,i+n),r.stroke()},setData:function(t){this.data=t},setPainterImplement:function(t){this.paintImplement=t}};var Ajax={};Ajax.request=function(t,e,i,n,o){o=void 0==o||o;var s=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):!!window.XMLHttpRequest&&new XMLHttpRequest,r=document.getElementById(n);r&&o&&(document.getElementById("chartLoading").style.display="block"),s.onreadystatechange=function(){4==s.readyState&&200==s.status&&(r&&o&&(document.getElementById("chartLoading").style.display="none"),i(s))},s.open(t||"POST",e,!0),s.overrideMimeType&&s.overrideMimeType("text/xml"),s.send()},Ajax.get=function(t,e,i,n){Ajax.request("GET",t,e,i,n)},Ajax.post=function(t,e,i,n){Ajax.request("POST",t,e,i,n)},xAxis.prototype={initialize:function(t){t.options=this.options},start:function(){var t=this.ctx;t.save(),t.fillStyle=this.options.color,t.font=this.options.font,this.options.textBaseline&&(t.textBaseline=this.options.textBaseline),t.translate(this.options.region.x,this.options.region.y)},getY:function(){return 0},getX:function(t){if(0==t)return 0;var e=this.ctx.measureText(this.data[t]).width;return t==this.data.length-1?this.options.region.width-e:this.options.region.width*t/(this.data.length-1)-e/2},paintItem:function(t,e,i){this.ctx.fillText(this.data[t],e,i)},end:function(){this.ctx.restore()}},yAxis.prototype={initialize:function(t){t.scalerOptions=this.scalerOptions},start:function(){var t=this.ctx;t.save(),"string"==typeof this.scalerOptions.color&&(t.fillStyle=this.scalerOptions.color),t.font=this.scalerOptions.font,t.translate(this.scalerOptions.region.x,this.scalerOptions.region.y),this.scalerOptions.textBaseline&&(t.textBaseline=this.scalerOptions.textBaseline)},end:function(){this.ctx.restore()},getX:function(t){if("left"==this.scalerOptions.align)return 0;var e=this.ctx.measureText(this.data[t]).width;return this.scalerOptions.region.width-e},getY:function(t){return 0==t?0:t==this.data.length-1?this.scalerOptions.region.height-this.scalerOptions.fontHeight:this.scalerOptions.region.height*t/(this.data.length-1)-this.scalerOptions.fontHeight/2},paintItem:function(t,e,i,n){n&&(this.ctx.fillStyle="#000",this.paintImplement.drawBgForItem.call(this,e,i,10,14)),"function"==typeof this.scalerOptions.color&&(this.ctx.fillStyle=this.scalerOptions.color(this.data[t])),this.ctx.fillText(this.data[t],e,i)},drawBgForItem:function(t,e,i,n){this.ctx.fillStyle="#0000ff",this.ctx.fillRect(t,e,i,n),this.ctx.fillStyle="#000"}},crossLinesAndTipMgr.prototype._removeTipAndCrossLines=function(){var t=this;t.tip&&t.tip.hide(),t.clsMgr&&t.clsMgr.removeCrossLines()},crossLinesAndTipMgr.prototype.updateOptions=function(t){this.options=t},crossLinesAndTipMgr.prototype._onMouseOrTouchMove=function(t){t=t||event,t=getOffset(t);var e=this,i=e.options,n=e.canvas,o=getPageCoord(n),s=i.triggerEventRanges;if(t.offsetX<s.x||t.offsetX>s.x+s.width||t.offsetY<s.y||t.offsetY>s.y+s.height)e._removeTipAndCrossLines();else{var r=i.getCrossPoint(t),a={crossPoint:r,verticalRange:{y1:s.y,y2:s.y+s.height},horizontalRange:{x1:s.x,x2:s.x+s.width},color:i.crossLineOptions.color,canvas:n};if(e.clsMgr)e.clsMgr.updateOptions(a);else{var h=new crossLines(a);h.setMouseEvents(function(t){t=t||event;var n={offsetX:(t=getOffset(t)).offsetX+s.x,offsetY:parseInt(e.clsMgr.getHLine().style.top)-o.y},r=i.getCrossPoint(n);h.updateCrossPoint(r),e.tip&&e.tip.update(r,i.tipOptions.getTipHtml(n))},function(t){t=t||event,t=getOffset(t);var n={offsetX:parseInt(e.clsMgr.getVLine().style.left)-o.x,offsetY:t.offsetY+s.y},r=i.getCrossPoint(n);h.updateCrossPoint(r),e.tip&&e.tip.update(r,i.tipOptions.getTipHtml(n))}),e.clsMgr=h}if(e.clsMgr.drawCrossLines(),i.tipOptions){var l=i.tipOptions;if(!e.tip){var c=new Tip({position:{x:l.position.x||!1,y:l.position.y||!1},size:l.size,opacity:l.opacity||80,cssClass:l.cssClass,offsetToPoint:l.offsetToPoint||30,relativePoint:{x:r.x,y:r.y},canvas:n,canvasRange:i.triggerEventRanges,innerHTML:l.getTipHtml(t)});e.tip=c}e.tip.show(r,l.getTipHtml(t))}}},crossLinesAndTipMgr.prototype._touchstart=function(t){(t=t||event).srcElement||t.target||t.relatedTarget;this.touchstartTime=new Date},crossLinesAndTipMgr.prototype._touchmove=function(t){t=t||event;var e=this.canvas,i=getPageCoord(e),n=(t.srcElement||t.target||t.relatedTarget,setTouchEventOffsetPosition(t,i));this._onMouseOrTouchMove(n)},crossLinesAndTipMgr.prototype._touchend=function(t){(t=t||event).srcElement||t.target||t.relatedTarget;var e=this.canvas;setTouchEventOffsetPosition(t,getPageCoord(e));this._removeTipAndCrossLines(),(new Date).getTime()-this.touchstartTime.getTime()<200&&"function"==typeof this.options.onClick&&this.options.onClick()},crossLinesAndTipMgr.prototype._mouseout=function(t){var e=t||event;t=getOffset(e);var i=this,n=i.options.triggerEventRanges;if(t.offsetX<=n.x||t.offsetX>=n.x+n.width||t.offsetY<=n.y||t.offsetY>=n.y+n.height)i._removeTipAndCrossLines();else{var o=e.toElement||e.relatedTarget||e.target;if(o){if(o==i.canvas)return;if(o==i.clsMgr.getHLine()||o==i.clsMgr.getVLine())return;i._removeTipAndCrossLines()}}},crossLinesAndTipMgr.prototype.addCrossLinesAndTipEvents=function(){var t=this.canvas,e=this.options;getPageCoord(t);if(1!=t.addCrossLinesAndTipEvents){t.addCrossLinesAndTipEvents=!0;var i=isTouchDevice(),n=this,o=n.options.controllerEvents;i?(addEvent(t,"touchstart",function(t){t=t||event,disableBubbleAndPreventDefault(t),n.options.shouldDoControllerEvent(t,"touchstart")?o.onStart(t):n._touchstart.call(n,t)}),addEvent(t,"touchmove",function(t){t=t||event,disableBubbleAndPreventDefault(t),n.options.shouldDoControllerEvent(t,"touchmove")?o.onMove(t):n._touchmove.call(n,t)}),addEvent(t,"touchend",function(t){t=t||event,disableBubbleAndPreventDefault(t),n.options.shouldDoControllerEvent(t,"touchend")&&o.onEnd(t),n._touchend.call(n,t)})):(addEvent(t,"mouseout",function(t){n.options.shouldDoControllerEvent(t)?o.onEnd(t):n._mouseout.call(n,t)}),addEvent(t,"mousemove",function(t){n.options.shouldDoControllerEvent(t)?o.onMove(t):n._onMouseOrTouchMove.call(n,t)}),addEvent(t,"mousedown",function(t){n.options.shouldDoControllerEvent(t)&&o.onStart(t)}),addEvent(t,"mouseup",function(t){o.onEnd(t)}),"function"==typeof e.onClick&&addEvent(t,"click",e.onClick))}},controller.prototype={calcPositions:function(){var t=this.region.width-this.bar.width;this.leftBarPosition=this.value.left*t/100+this.bar.width/2,this.rightBarPosition=this.value.right*t/100+this.bar.width/2},drawControllerPart:function(){this.canvas;var t=this.ctx;t.save();var e=this.region,i=this.bar;this.calcPositions();var n=this.leftBarPosition,o=this.rightBarPosition;t.clearRect(e.x-1,e.y-1,e.width+1,e.height+1),"function"==typeof this.prePaint&&this.prePaint(t),t.lineWidth=1,t.strokeStyle=e.borderColor,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.x,e.y+e.height),t.lineTo(e.x+n,e.y+e.height),t.lineTo(e.x+n,e.y+e.height-(e.height-i.height)/2),t.stroke(),t.strokeStyle=e.borderColor,t.beginPath(),t.moveTo(e.x+n,e.y+e.height/2-i.height/2),t.lineTo(e.x+n,e.y),t.lineTo(e.x,e.y),t.stroke(),t.beginPath(),t.moveTo(e.x+n,e.y+e.height),t.lineTo(e.x+e.width,e.y+e.height),t.lineTo(e.x+e.width,e.y),t.lineTo(e.x+o,e.y),t.lineTo(e.x+o,e.y+e.height/2-i.height/2),t.stroke(),t.beginPath(),t.moveTo(e.x+o,e.y+e.height/2+i.height/2),t.lineTo(e.x+o,e.y+e.height),t.stroke(),t.beginPath(),t.fillStyle="blue",t.globalAlpha=.5,t.rect(e.x+n,e.y,o-n,e.height),t.closePath(),t.fill(),t.globalAlpha=1,t.strokeStyle=i.borderColor,t.fillStyle=i.fillColor,t.beginPath();var s={x:e.x+n-i.width/2,y:e.y+e.height/2-i.height/2,width:i.width,height:i.height};t.rect(s.x,s.y,s.width,s.height),this.leftBarRegion=s,t.closePath(),t.stroke(),t.fill(),t.beginPath();var r={x:e.x+o-i.width/2,y:e.y+e.height/2-i.height/2,width:i.width,height:i.height};t.rect(r.x,r.y,r.width,r.height),this.rightBarRegion=r,t.closePath(),t.stroke(),t.fill(),t.restore()},setLeftBarPosition:function(t){t<this.bar.width/2?this.leftBarPosition=this.bar.width/2:this.rightBarPosition-t-this.minBarDistance>this.bar.width?this.leftBarPosition=t:this.leftBarPosition=this.rightBarPosition-this.bar.width-this.minBarDistance,this.value=this.getValue()},setRightBarPosition:function(t){t<this.leftBarPosition+this.bar.width+this.minBarDistance?this.rightBarPosition=this.leftBarPosition+this.bar.width+this.minBarDistance:t>this.region.width-this.bar.width/2?this.rightBarPosition=this.region.width-this.bar.width/2:this.rightBarPosition=t,this.value=this.getValue()},addControllerEvents:function(){var t=this;if(t.isTouchDevice){var e=t.canvas;addEvent(e,"touchmove",function(e){(e=e||event).srcElement||e.target||e.relatedTarget;var i=e.touches;if(i&&i.length){var n=!1,o=getPageCoord(this.canvas);if(t.fingers&&t.fingers.length)for(var s=0;s<t.fingers.length;s++)for(var r=t.fingers[s],a=0;a<i.length;a++){var h=i[a];if(h.identifier==r.id){var l=h.pageX-o.x-r.startX;0!=l&&("left"==r.type?t.setLeftBarPosition(r.leftPosition+l):"right"==r.type?t.setRightBarPosition(r.rightPosition+l):(t.setLeftBarPosition(r.leftPosition+l),t.setRightBarPosition(r.rightPosition+l)),n=!0);break}}n&&(t.drawControllerPart(),"function"==typeof t.onPositionChanged&&t.isValueChanged()&&(t.value=t.getValue(),t.onPositionChanged(t.value))),disableBubbleAndPreventDefault(e)}}),addEvent(e,"touchend",function(e){if(e=e||event,t.fingers&&t.fingers.length)"function"==typeof t.onPositionChanged&&t.isValueChanged()&&(t.value=t.getValue(),t.onPositionChanged(t.value));else if((new Date).getTime()-t.touchstartTime.getTime()<window.tapTimeLimit&&t.startTouch){var i=getPageCoord(t.canvas),n=t.startTouch,o={offsetX:n.pageX-i.x,offsetY:n.pageY-i.y},s=(t.rightBarPosition+t.leftBarPosition)/2,r=o.offsetX-s;t.setLeftBarPosition(t.leftBarPosition+r),t.setRightBarPosition(t.rightBarPosition+r),t.drawControllerPart(),"function"==typeof t.onPositionChanged&&t.isValueChanged()&&(t.value=t.getValue(),t.onPositionChanged(t.value)),t.startTouch=null}t.fingers=null,disableBubbleAndPreventDefault(e)}),addEvent(e,"touchstart",function(e){var i=e.touches;i&&i.length||(i=e.changedTouches),t.touchstartTime=new Date,t.startTouch=i[0];e.srcElement||e.target||e.relatedTarget;var n=getPageCoord(t.canvas);if(t.fingers=[],i.length)for(var o=0;o<i.length;o++){var s=i[o],r=function(e){return t.isOnLeftBar(e)?"left":t.isOnRightBar(e)?"right":!!t._isBetweenLeftAndRight(e)&&"middle"}({offsetX:s.pageX-n.x,offsetY:s.pageY-n.y});if(r){var a={id:s.identifier,startX:s.pageX-n.x,type:r,leftPosition:t.leftBarPosition,rightPosition:t.rightBarPosition};t.fingers.push(a)}}return disableBubbleAndPreventDefault(e),!1})}else{var i=function(e){var i=t.isOnLeftBar(e),n=t.isOnRightBar(e);if(t._isBetweenLeftAndRight(e)?document.body.style.cursor="pointer":i||n||t.triggerBar?document.body.style.cursor="col-resize":document.body.style.cursor="default",t.triggerBar){t.triggerBar.targetX=e.offsetX;var o=t.triggerBar.targetX-t.triggerBar.x;"left"==t.triggerBar.type?(document.body.style.cursor="col-resize",t.setLeftBarPosition(t.triggerBar.position+o)):"right"==t.triggerBar.type?t.setRightBarPosition(t.triggerBar.position+o):(t.setLeftBarPosition(t.triggerBar.leftPosition+o),t.setRightBarPosition(t.triggerBar.rightPosition+o)),"function"==typeof t.onPositionChanged&&t.isValueChanged()&&(t.value=t.getValue(),t.onPositionChanged(t.value)),t.drawControllerPart()}},n=function(e){t.triggerBar,t.triggerBar=null,document.body.style.cursor="default","function"==typeof t.onPositionChanged&&t.isValueChanged()&&(t.value=t.getValue(),t.onPositionChanged(t.value))},o=function(e){var i=t.isOnLeftBar(e),n=t.isOnRightBar(e),o=t._isBetweenLeftAndRight(e);document.body.style.cursor=o?"pointer":i||n?"col-resize":"default",t.triggerBar=i?{type:"left",x:e.offsetX,position:t.leftBarPosition}:n?{type:"right",x:e.offsetX,position:t.rightBarPosition}:o?{type:"middle",x:e.offsetX,leftPosition:t.leftBarPosition,rightPosition:t.rightBarPosition}:null};addEvent(t.canvas,"mouseup",n),addEvent(t.canvas,"mouseout",n),addEvent(t.canvas,"mousemove",function(t){(t=t||event).preventDefault?t.preventDefault():t.returnValue=!1;var e=getOffset(t);i(e)}),addEvent(t.canvas,"mousedown",function(t){t=t||event;var e=getOffset(t);o(e)})}},isValueChanged:function(){if(void 0===this.preValue)return this.preValue=this.getValue(),!1;if(isTouchDevice()&&this.latestChangeTime&&(new Date).getTime()-this.latestChangeTime.getTime()<50)return!1;var t=this.preValue,e=this.getValue(),i=Math.abs(e.left-t.left)+Math.abs(e.right-t.right);return this.preValue=e,0!=i&&(this.latestChangeTime=new Date),0!=i},_isInRegion:function(t,e){return t.offsetX>e.x&&t.offsetX<e.x+e.width&&t.offsetY>e.y&&t.offsetY<e.y+e.height},_isBetweenLeftAndRight:function(t){var e=this.region,i={x:e.x+this.leftBarPosition+this.bar.width/2,y:e.y,width:this.rightBarPosition-this.leftBarPosition-this.bar.width,height:this.region.height};return this._isInRegion(t,i)},_getTouchFaultToleranceRegion:function(t){var e=this;return e.isTouchDevice&&(t.x-=e.touchFaultTolerance/2,t.width+=e.touchFaultTolerance/2),t},isOnLeftBar:function(t){var e=this._getTouchFaultToleranceRegion(this.leftBarRegion);return this._isInRegion(t,e)},isOnRightBar:function(t){var e=this._getTouchFaultToleranceRegion(this.rightBarRegion);return this._isInRegion(t,e)},getValue:function(){var t=this.region.width-this.bar.width;return{left:100*(this.leftBarPosition-this.bar.width/2)/t,right:100*(this.rightBarPosition-this.bar.width/2)/t}}},crossLines.prototype={updateOptions:function(t){this.canvas=t.canvas,this.canvasId=this.canvas.id,this.horizontalDivId=this.canvasId+"_crossLines_H",this.verticalDivId=this.canvasId+"_crossLines_V",this.verticalRange=t.verticalRange||{y1:0,y2:this.canvas.height},this.horizontalRange=t.horizontalRange||{x1:0,x2:this.canvas.width},this.canvasPosition=getPageCoord(this.canvas),this.crossPoint=t.crossPoint,this.color=t.color||"black"},removeCrossLines:function(){var t=this.canvas.id,e=t+"_crossLines_H",i=t+"_crossLines_V",n=$id(e);n&&(n.style.display="none");var o=$id(i);o&&(o.style.display="none")},getHLine:function(){return $id(this.horizontalDivId)},getVLine:function(){return $id(this.verticalDivId)},setMouseEvents:function(t,e){this.hLineMouseEvt=t,this.vLineMouseEvt=e},updateCrossPoint:function(t){this.crossPoint=t,this.drawCrossLines()},drawCrossLines:function(){var t=this.canvas,e=this.canvas.id,i=e+"_crossLines_H",n=e+"_crossLines_V",o=this.verticalRange||{y1:0,y2:t.height},s=this.horizontalRange||{x1:0,x2:t.width},r=this.canvasPosition;if(this.crossPoint.x<s.x1||this.crossPoint.x>s.x2||this.crossPoint.y<o.y1||this.crossPoint.y>o.y2)this.removeCrossLines();else{var a,h=(t.style.zIndex||1)+1,l=!1;$id(i)?(l=!0,a=$id(i)):(a=document.createElement("DIV")).id=i,a.style.display="block",a.style.position="absolute",a.style.width=Math.round(s.x2-s.x1)+"px",a.style.height="1px",a.style.left=Math.round(r.x+s.x1)+"px",a.style.top=Math.round(this.crossPoint.y+r.y)+"px",a.style.backgroundColor=this.color,a.style.zIndex=h,l||(document.body.appendChild(a),"function"==typeof this.hLineMouseEvt&&(addEvent(a,"mouseover",this.hLineMouseEvt),addEvent(a,"mousemove",this.hLineMouseEvt))),l=!1;var c;$id(n)?(l=!0,c=$id(n)):(c=document.createElement("DIV")).id=n,c.style.display="block",c.style.position="absolute",c.style.height=Math.round(o.y2-o.y1)+"px",c.style.width="1px",c.style.left=Math.round(this.crossPoint.x+r.x)+"px",c.style.top=Math.round(o.y1+r.y)+"px",c.style.backgroundColor=this.color,c.style.index=h,l||(document.body.appendChild(c),"function"==typeof this.vLineMouseEvt&&(addEvent(c,"mouseover",this.vLineMouseEvt),addEvent(c,"mousemove",this.vLineMouseEvt)))}}},linePainter.prototype={initialize:function(t){t.options=this.options},getDataLength:function(){return this.options.getDataLength.call(this)},getX:function(t){return(t+1)*(this.options.region.width/this.options.maxDotsCount)},start:function(){var t=this.ctx,e=this.options,i=e.region;t.save(),t.translate(i.x,i.y+i.height/2);var n=0;this.data.items.each(function(t){var i=Math.abs(e.middleValue-e.getItemValue(t));n=Math.max(i,n)}),this.maxDiff=n,t.beginPath(),t.strokeStyle=e.lineColor},end:function(){var t=this.ctx.createLinearGradient(0,0,0,100);t.addColorStop(0,"rgba(39,144,209, 0.1)"),t.addColorStop(1,"rgba(39,144,209, 0.6)"),this.ctx.fillStyle=t,this.ctx.fill(),this.ctx.stroke(),this.ctx.restore()},getY:function(t){var e=this.options;return 0-(e.getItemValue(this.data.items[t])-e.middleValue)*e.region.height/2/this.maxDiff},paintItem:function(t,e,i){var n=this.ctx;0==t?n.moveTo(e,i):n.lineTo(e,i)},paintItemForBg:function(t,e){this.ctx.lineTo(e.x,this.options.region.height-80),this.ctx.lineTo(t.x,this.options.region.height-80)}},loading.prototype={show:function(){var t=this.canvas;if(t.getContext&&!t.__loading){t.__loading=this;var e=t.getContext("2d"),i=this.radius,n=[{angle:0,radius:1.5},{angle:3/i,radius:2},{angle:7/i,radius:2.5},{angle:12/i,radius:3}],o=this;t.loadingInterval=setInterval(function(){e.clearRect(0,0,t.width,t.height);var s=o.circleLineWidth,r={x:t.width/2-i,y:t.height/2-i};e.beginPath(),e.lineWidth=s,e.strokeStyle=o.circleColor,e.arc(r.x,r.y,i,0,2*Math.PI),e.closePath(),e.stroke();for(var a=0;a<n.length;a++){var h=n[a].currentAngle||n[a].angle,l={x:r.x-i*Math.cos(h),y:r.y-i*Math.sin(h)},c=n[a].radius;e.beginPath(),e.fillStyle=o.dotColor,e.arc(l.x,l.y,c,0,2*Math.PI),e.closePath(),e.fill(),n[a].currentAngle=h+4/i}},50)}},hide:function(){var t=this.canvas;t.__loading=!1,t.loadingInterval&&window.clearInterval(t.loadingInterval);var e=t.getContext("2d");e&&e.clearRect(0,0,t.width,t.height)}},Tip.prototype={getElementId:function(){return this.canvas.id+"_tip"},_getRightLimit:function(){return this.canvasRange.x+this.canvasRange.width},_getLeftLimit:function(){return this.canvasRange.x},_getTopLimit:function(){return this.canvasRange.y},_getBottomLimit:function(){return this.canvasRange.y+this.canvasRange.height},show:function(t,e){t&&(this.relativePoint=t),e&&(this.innerHTML=e);var i=$id(this.getElementId()),n=this.size,o=this.offsetToPoint,s=this.position,t=this.relativePoint,r=getPageCoord(this.canvas),a=s.y||t.y,h=s.x||t.x,l=0,c=0;if(s.x)l=s.x;else if(i){var g=parseInt(i.style.left)-r.x;l=g=g>h?o+h+n.width>this._getRightLimit()?h-o-n.width:h+o:h-o-n.width>this._getLeftLimit()?h-o-n.width:h+o}else(l=h+o)>this._getRightLimit()&&(l=h-o-n.width);if(s.y)c=s.y;else if(i){var d=parseInt(i.style.top)-r.y;c=d=d>a?o+a+n.height>this._getBottomLimit()?a-o-n.height:a+o:a-o-n.height>this._getTopLimit()?a-o-n.height:a+o}else(c=a+o)>this._getBottomLimit()&&(c=a-o-n.height);if(!i){(i=document.createElement("DIV")).id=this.getElementId();var u=this.opacity||100;i.style.cssText="-moz-opacity:."+u+"; filter:alpha(opacity="+u+"); opacity:"+u/100+';line-height:18px;font-family:Arial,"宋体";font-size:9pt;padding:4px;',i.style.position="absolute",i.style.zIndex=4+(this.canvas.style.zIndex||1),i.style.backgroundColor="white",i.style.border="1px solid gray",i.style.width=this.size.width+"px",i.style.height=this.size.height+"px",this.cssClass&&(i.className=this.cssClass),document.body.appendChild(i)}l=r.x+l,c=r.y+c,i.style.left=l+"px",i.style.top=c+"px",i.style.display="block",i.innerHTML=this.innerHTML},hide:function(){var t=$id(this.getElementId());t&&(t.style.display="none")},update:function(t,e){this.relativePoint=t,this.innerHTML=e,this.show()}},function(){function t(){this.tapTimeLimit=500}Array.prototype.each=function(t,e,i){e=e||0,i=i||this.length-1;for(var n=e;n<=i;n++)if(t(this[n],this,n),this.breakLoop){this.breakLoop=!1;break}},t.prototype={preventDefaultEvent:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},isTouchDevice:function(){return!!("ontouchstart"in window)},toMoney:function(t){return t.toFixed(2)},bigNumberToText:function(t){var e,i=t/1e8;if(i>1)e=i.toFixed(2)+"亿";else{var n=t/1e4;e=n>1?n.toFixed()+"万":t}return e},getOffset:function(t){if(!isNaN(t.offsetX)&&!isNaN(t.offsetY))return t;var e=t.target;void 0==e.offsetLeft&&(e=e.parentNode);var i=getPageCoord(e),n={x:window.pageXOffset+t.clientX,y:window.pageYOffset+t.clientY};return{offsetX:n.x-i.x,offsetY:n.y-i.y}},getPageCoord:function(t){for(var e={x:0,y:0};t;)e.x+=t.offsetLeft,e.y+=t.offsetTop,t=t.offsetParent;return e},addLoadEvent:function(t){var e=window.onload;window.onload="function"!=typeof e?t:function(){e(),t()}},addEvent:function(t,e,i,n){return t.addEventListener?(t.addEventListener(e,i,n),!0):t.attachEvent?t.attachEvent("on"+e,i):void(t["on"+e]=i)},getEventTarget:function(t){return t.srcElement||t.target||t.relatedTarget},$id:function(t){return document.getElementById(t)}},window.extendObject=function(t,e){for(var i in t)e[i]=t[i]},window.extendWindow=function(t){extendObject(t,window)};var e=new t;extendWindow(e),window.getQueryParam=function(t,e){var i=new RegExp("[?&]"+t+"=([^&]+)","i").exec(e?window.top.location.search:location.search);return i&&i.length>1?decodeURIComponent(i[1]):""},window.debug=getQueryParam("debug"),window.setDebugMsg=function(t){if(window.debug)try{var e=$id("debug");e||((e=document.createElement("DIV")).id="debug",document.body.appendChild(e)),e.innerHTML=2==window.debug?t+"<br/>"+e.innerHTML:t}catch(e){alert(t+";error:"+e)}}}(),volumePainter.prototype={initialize:function(t){t.options=this.options,t.barWidth=this.barWidth,t.spaceWidth=this.spaceWidth},getDataLength:function(){return this.options.getDataLength.call(this)},getX:function(t){return this.options.region.x+t*(this.barWidth+this.spaceWidth)},start:function(){var t=this.ctx,e=this.options;e.region;t.save();var i=0;this.data.items.each(function(t){i=Math.max(i,t.volume)}),this.maxVolume=i,t.fillStyle=e.bar.color},end:function(){this.ctx.restore()},getY:function(t){return this.options.region.y+(this.maxVolume-this.data.items[t].volume)*this.options.region.height/this.maxVolume},paintItem:function(t,e,i){var n=this.ctx;n.beginPath(),n.rect(e,i,this.barWidth,this.options.region.y+this.options.region.height-i),n.fill()}},_crossLinesAndTipMgr.prototype._removeTipAndCrossLines=function(){var t=this;t.tip&&t.tip.hide(),t.clsMgr&&t.clsMgr.removeCrossLines()},_crossLinesAndTipMgr.prototype.updateOptions=function(t){this.options=t},_crossLinesAndTipMgr.prototype._onMouseOrTouchMove=function(t){t=t||event,t=getOffset(t);var e=this,i=e.options,n=e.canvas,o=getPageCoord(n),s=i.triggerEventRanges;if(t.offsetX<s.x||t.offsetX>s.x+s.width||t.offsetY<s.y||t.offsetY>s.y+s.height)e._removeTipAndCrossLines();else{var r=i.getCrossPoint(t),a={crossPoint:r,verticalRange:{y1:s.y,y2:s.y+s.height},horizontalRange:{x1:s.x,x2:s.x+s.width},color:i.crossLineOptions.color,canvas:n};if(e.clsMgr)e.clsMgr.updateOptions(a);else{var h=new crossLines(a);h.setMouseEvents(function(t){t=t||event;var n={offsetX:(t=getOffset(t)).offsetX+s.x,offsetY:parseInt(e.clsMgr.getHLine().style.top)-o.y},r=i.getCrossPoint(n);h.updateCrossPoint(r),e.tip&&e.tip.update(r,i.tipOptions.getTipHtml(n))},function(t){t=t||event,t=getOffset(t);var n={offsetX:parseInt(e.clsMgr.getVLine().style.left)-o.x,offsetY:t.offsetY+s.y},r=i.getCrossPoint(n);h.updateCrossPoint(r),e.tip&&e.tip.update(r,i.tipOptions.getTipHtml(n))}),e.clsMgr=h}if(e.clsMgr.drawCrossLines(),i.tipOptions){var l=i.tipOptions;if(!e.tip){var c=new _Tip({position:{x:l.position.x||!1,y:l.position.y||!1},size:l.size,opacity:l.opacity||80,cssClass:l.cssClass,offsetToPoint:l.offsetToPoint||30,relativePoint:{x:r.x,y:r.y},canvas:n,canvasRange:i.triggerEventRanges,innerHTML:l.getTipHtml(t)});e.tip=c}e.tip.show(r,l.getTipHtml(t))}}},_crossLinesAndTipMgr.prototype._touchstart=function(t){t=t||event,disableBubbleAndPreventDefault(t);t.srcElement||t.target||t.relatedTarget;this.touchstartTime=new Date},_crossLinesAndTipMgr.prototype._touchmove=function(t){t=t||event,disableBubbleAndPreventDefault(t);var e=this.canvas,i=getPageCoord(e),n=(t.srcElement||t.target||t.relatedTarget,setTouchEventOffsetPosition(t,i));this._onMouseOrTouchMove(n)},_crossLinesAndTipMgr.prototype._touchend=function(t){t=t||event,disableBubbleAndPreventDefault(t);t.srcElement||t.target||t.relatedTarget;var e=this.canvas;setTouchEventOffsetPosition(t,getPageCoord(e));this._removeTipAndCrossLines(),(new Date).getTime()-this.touchstartTime.getTime()<200&&"function"==typeof this.options.onClick&&this.options.onClick()},_crossLinesAndTipMgr.prototype._mouseout=function(t){var e=t||event;t=getOffset(e);var i=this,n=i.options.triggerEventRanges;if(t.offsetX<=n.x||t.offsetX>=n.x+n.width||t.offsetY<=n.y||t.offsetY>=n.y+n.height)i._removeTipAndCrossLines();else{var o=e.toElement||e.relatedTarget||e.target;if(o){if(o==i.canvas)return;if(o==i.clsMgr.getHLine()||o==i.clsMgr.getVLine())return;i._removeTipAndCrossLines()}}},_crossLinesAndTipMgr.prototype.addCrossLinesAndTipEvents=function(){var t=this.canvas,e=this.options;getPageCoord(t);if(1!=t.addCrossLinesAndTipEvents){t.addCrossLinesAndTipEvents=!0;var i=this;isTouchDevice()?(addEvent(t,"touchstart",function(t){i._touchstart.call(i,t)}),addEvent(t,"touchmove",function(t){i._touchmove.call(i,t)}),addEvent(t,"touchend",function(t){i._touchend.call(i,t)})):(addEvent(t,"mouseout",function(t){i._mouseout.call(i,t)}),addEvent(t,"mousemove",function(t){i._onMouseOrTouchMove.call(i,t)}),"function"==typeof e.onClick&&addEvent(t,"click",e.onClick))}},console.log("~~");var data=[];setTimeout(function(){select(0)},1e3);var timer={start:function(t){this.startTime=new Date,this.stepName=t},stop:function(){var t=(new Date).getTime()-this.startTime.getTime();setDebugMsg(this.stepName+"耗时"+t+"ms")}};kLine.prototype={initialize:function(t){t.klOptions=this.options,t.implement=this},start:function(){var t=this.canvas,e=this.ctx;this.painting=!0;var i=this.klOptions,n={width:t.width,height:i.priceLine.region.y-3};e.clearRect(0,0,n.width,n.height),e.save(),window.riseColor=i.riseColor,window.fallColor=i.fallColor,window.normalColor=i.normalColor,i.backgroundColor&&!this.drawnBackground&&(e.beginPath(),e.fillStyle=i.backgroundColor,e.rect(0,0,n.width,n.height),e.fill(),this.drawnBackground=!0),e.translate(i.region.x,i.region.y),e.strokeStyle=i.borderColor,e.beginPath(),e.rect(0,0,i.region.width,i.region.height),e.stroke();for(var o=i.region.height/(i.horizontalLineCount+1),s=1;s<=i.horizontalLineCount;s++){var r=o*s;10*r%10==0&&(r+=.5),this.drawHLine(i.splitLineColor,0,r,i.region.width,1,i.lineStyle)}for(var a=i.region.width/(i.verticalLineCount+1),s=1;s<=i.verticalLineCount;s++){var h=a*s;10*h%10==0&&(h+=.5),this.drawVLine(i.splitLineColor,h,0,i.region.height,1,i.lineStyle)}},end:function(){function t(t){t-=h.x;var e=Math.ceil(t/(r.klOptions.spaceWidth+r.klOptions.barWidth))-1,i=r.toIndex-r.startIndex+1;return e>=i&&(e=i-1),e}function e(e){var i=t(e);return h.x+r.klOptions.spaceWidth*(i+1)+r.klOptions.barWidth*i+.5*r.klOptions.barWidth}function i(t,e){return e>t.preClose?riseColor:e<t.preClose?fallColor:normalColor}function n(e){var n=r.startIndex+t(e);n>=r.data.ks.length&&(n=r.data.ks.length-1),n<0&&(n=0);var o=r.data.ks[n];return"<div><b>"+convertDate(o.quoteTime)+'</b></div>昨收价：<font color="'+i(o,o.preClose)+'">'+toMoney(o.preClose)+'</font><br/>开盘价：<font color="'+i(o,o.open)+'">'+toMoney(o.open)+'</font><br/>最高价：<font color="'+i(o,o.high)+'">'+toMoney(o.high)+'</font><br/>最低价：<font color="'+i(o,o.low)+'">'+toMoney(o.low)+'</font><br/>收盘价：<font color="'+i(o,o.close)+'">'+toMoney(o.close)+"</font><br/>成交量："+bigNumberToText(o.volume/100)+"手<br/>成交额："+bigNumberToText(o.amount)}function o(t){return isTouchDevice()?setTouchEventOffsetPosition(t,getPageCoord(r.canvas)):getOffset(t)}function s(t,e){if(void 0==e)return!0;if(void 0===r.shouldController&&(r.shouldController=!0),"touchstart"==e){var i=o(t),n=!1,s=i.offsetX;s-=h.x;var a=Math.ceil(s/(r.klOptions.spaceWidth+r.klOptions.barWidth))-1,l=Math.ceil(g.width/(r.klOptions.spaceWidth+r.klOptions.barWidth))+1,c=Math.max(0,a-l/2),d=Math.min(r.filteredData.length-1,a+l/2),u=999999,f=-1;for(a=c;a<=d;a++){var p=r.filteredData[a],v=h.y+(r.high-p.high)*h.height/(r.high-r.low)-g.height,y=h.y+(r.high-p.low)*h.height/(r.high-r.low)+g.height;u=Math.min(v,u),f=Math.max(y,f)}n=i.offsetY>=u&&i.offsetY<=f,setDebugMsg("yMin="+u+",yMax="+f+",offsetY="+i.offsetY+",showTip="+n),r.shouldController=!n}return r.shouldController}this.ctx.restore();var r=this,a=r.klOptions,h=a.region,l=a.volume.region,c={onStart:function(t){var e=o(t=t||event);r.controllerStartOffset=e,r.controllerStartRange=r.dataRanges},onEnd:function(t){r.controllerStartOffset=null,r.controllerStartRange=null},onMove:function(t){if(r.controllerStartOffset){var e=o(t=t||event).offsetX-r.controllerStartOffset.offsetX,i=r.controllerStartRange,n=0-e/h.width*(i.to-i.start),s=i.start+n,a=i.to+n;s<0?a=(s=0)+(i.to-i.start):a>100&&(s=(a=100)-(i.to-i.start));var l={left:s,right:a};r.painting||drawKL({start:l.left,to:l.right})}}},g={width:30,height:20};r.crossLineAndTipMgrInstance?r.crossLineAndTipMgrInstance.updateOptions({getCrossPoint:function(t){return{x:e(t.offsetX),y:t.offsetY}},triggerEventRanges:{x:h.x,y:h.y+1,width:h.width,height:l.y+l.height-h.y},tipOptions:{getTipHtml:function(t){return n(t.offsetX)},size:{width:120,height:150},position:{x:!1,y:h.y+(h.height-150)/3},opacity:80,cssClass:"",offsetToPoint:30},crossLineOptions:{color:"black"},shouldDoControllerEvent:s,controllerEvents:c}):(r.crossLineAndTipMgrInstance=new crossLinesAndTipMgr(r.canvas,{getCrossPoint:function(t){return{x:e(t.offsetX),y:t.offsetY}},triggerEventRanges:{x:h.x,y:h.y+1,width:h.width,height:l.y+l.height-h.y},tipOptions:{getTipHtml:function(t){return n(t.offsetX)},size:{width:120,height:150},position:{x:!1,y:h.y+(h.height-150)/3},opacity:80,cssClass:"",offsetToPoint:30},crossLineOptions:{color:"black"},shouldDoControllerEvent:s,controllerEvents:c}),r.crossLineAndTipMgrInstance.addCrossLinesAndTipEvents()),r.addOrentationChangedEvent||(r.addOrentationChangedEvent=!0,addEvent(window,"orientationchange",function(t){r.requestController=!0,r.implement.onOrentationChanged.call(r)})),r.painting=!1},paintItems:function(){function t(t){return(x.high-t)*n.height/(x.high-x.low)}function e(t){var e=t*(i.spaceWidth+i.barWidth)+.5*(i.spaceWidth+i.barWidth);return 10*e%10==0&&(e+=.5),e}var i=this.klOptions,n=i.region,o=this.data.ks.length,s=!0;if(null==this.dataRanges){var r=Math.ceil(n.width/(i.spaceWidth+i.barWidth))-1;r>o&&(r=o),this.dataRanges={start:100*(this.data.ks.length-r)/this.data.ks.length,to:100},s=!1}var a=this.dataRanges,h=Math.ceil(a.start/100*o),l=Math.ceil(a.to/100*o)+1;l==o&&(l=o-1),this.startIndex=h,this.toIndex=l;var c=l-h+1;if(s){var g,d;(i.spaceWidth+i.barWidth)*c<=n.width?(g=1,(d=(n.width-g*c)/c)>4&&(g=2,d=(n.width-g*c)/c)):(g=1,(d=(n.width-g*c)/c)<=2?(g=0,d=(n.width-g*c)/c):d>4&&(g=2,d=(n.width-g*c)/c)),i.barWidth=d,i.spaceWidth=g}for(var u=[],f=h;f<=l&&f<o;f++)u.push(this.data.ks[f]);var p,v;u.each(function(t,e,i){0==i?(p=t.high,v=t.low):(p=Math.max(t.high,p),v=Math.min(v,t.low))}),this.high=p,this.low=v;var y=this.ctx,x=this;this.implement.paintMAs.call(this,u,t);var m=0,w=i.barWidth>1.5;u.each(function(n,o,s){var r=n.close>n.open,a=r?riseColor:fallColor,h=e(s);if(0==m)m=h;else if(h-m<1)return;m=h;var l=t(n.high),c=t(n.low);if(w){y.fillStyle=a,y.strokeStyle=a;var g,d;r?(g=t(n.close),d=t(n.open)-g):(g=t(n.open),d=t(n.close)-g),y.beginPath(),y.moveTo(h,l),y.lineTo(h,c),y.stroke();var u=h-i.barWidth/2;y.beginPath(),y.fillRect(u,g,i.barWidth,d)}else y.strokeStyle=a,y.beginPath(),y.moveTo(h,l),y.lineTo(h,c),y.stroke()}),this.filteredData=u;var C=i.yAxis;C.region=C.region||{x:7.4*p.toString().length-n.x,y:-3,height:n.height,width:n.x-3};var T=new yAxis(C);new Painter(this.canvas.id,T,calcAxisValues(p,v,i.horizontalLineCount+2)).paint();var L=i.xAxis;L.region={x:0,y:n.height+2,width:n.width,height:20};var b=new xAxis(L),P=[],M=u.length/(i.xAxis.scalerCount-1);M<1&&(i.xAxis.scalerCount=u.length,M=1),P.push(convertDate(u[0].quoteTime,!1).substr(2));for(f=1;f<i.xAxis.scalerCount;f++){var A=Math.ceil(f*M);A>=u.length&&(A=u.length-1);var B=convertDate(u[A].quoteTime,!1);B=B.substr(2),P.push(B)}new Painter(this.canvas.id,b,P).paint(),this.implement.paintVolume.call(this,u)},paintPriceLine:function(){function t(t){return t*o.width/d}function e(t){return(c.high-t)*o.height/(c.high-c.low)}if(!this.hasPaintPriceLine){this.hasPaintPriceLine=!0;var i=this.ctx,n=this.klOptions.priceLine,o=n.region;i.save(),i.translate(o.x,o.y),i.clearRect(0-o.x,0,this.canvas.width,o.height);for(var s=o.height/(n.horizontalLineCount+1),r=1;r<=n.horizontalLineCount;r++){var a=s*r;10*a%10==0&&(a+=.5),this.drawHLine(n.splitLineColor,0,a,o.width,1,n.lineStyle)}for(var h=o.width/(n.verticalLineCount+1),r=1;r<=n.verticalLineCount;r++){var l=h*r;10*l%10==0&&(l+=.5),this.drawVLine(n.splitLineColor,l,0,o.height,1,n.lineStyle)}var c,g=this.data.ks,d=g.length;g.each(function(t,e,i){0==i?c={high:t.high,low:t.low}:(c.high=Math.max(c.high,t.close),c.low=Math.min(c.low,t.close))}),c.low>1&&(c.low-=1);var u=0;g.each(function(n,o,s){var r=t(s);if(0==u)u=r;else if(r-u<1)return;u=r;var a=e(n.close);0==s?(i.beginPath(),i.moveTo(r,a)):i.lineTo(r,a)}),i.strokeStype=n.borderColor,i.stroke(),i.lineTo(o.width,o.height),i.lineTo(0,o.height),i.closePath(),i.fillStyle=n.fillColor,i.globalAlpha=n.alpha,i.fill(),i.globalAlpha=1;var f=n.yAxis;f.region=f.region||{x:0-o.x,y:-3,height:o.height,width:o.x-3};var p=new yAxis(f);new Painter(this.canvas.id,p,calcAxisValues(c.high,c.low,n.horizontalLineCount+2)).paint(),i.restore()}},paintMAs:function(t,e){var i=this.ctx,n=this.klOptions,o=n.MAs,s=this;o.each(function(e,i,n){var o=calcMAPrices(s.data.ks,s.startIndex,t.length,e.daysCount);e.values=o,o.each(function(t,e,i){t&&(s.high=Math.max(s.high,t),s.low=Math.min(s.low,t))})}),o.each(function(t,o,s){var r=t.values;i.strokeStyle=t.color,i.beginPath();r.each(function(t,o,s){var r=s*(n.spaceWidth+n.barWidth)+.5*(n.spaceWidth+n.barWidth);if(t){var a=e(t);a&&0==s?i.moveTo(r,a):i.lineTo(r,a)}}),i.stroke()})},paintVolume:function(t){function e(t){return r.height-r.height/d*t}function i(t){return t*(o.spaceWidth+o.barWidth)+.5*o.spaceWidth}var n=this.ctx,o=this.klOptions,s=o.volume,r=s.region;n.restore(),n.save(),n.translate(r.x,r.y),n.globalAlpha=1;for(var a=r.height/(s.horizontalLineCount+1),h=1;h<=s.horizontalLineCount;h++){var l=a*h;10*l%10==0&&(l+=.5),this.drawHLine(o.splitLineColor,0,l,o.region.width,1,o.lineStyle)}for(var c=o.region.width/(o.verticalLineCount+1),h=1;h<=o.verticalLineCount;h++){var g=c*h;10*g%10==0&&(g+=.5),this.drawVLine(o.splitLineColor,g,0,r.height,1,o.lineStyle)}n.strokeStyle=o.borderColor,n.beginPath(),n.rect(0,0,r.width,r.height),n.stroke();var d=0;t.each(function(t,e,i){d=Math.max(d,t.volume)}),d*=1.05,n.globalAlpha=1,t.each(function(t,s,a){var h=i(a),l=e(t.volume);n.beginPath(),n.rect(h,l,o.barWidth,r.height/d*t.volume),n.fillStyle=t.close>t.open?riseColor:fallColor,n.fill()});var u,f;d<1e6?(u=1e4,f="万"):(u=1e6,f="百万");var p=[];p.push((d/u).toFixed(2)),p.push((d/2/u).toFixed(2)),p.push(f);var v=s.yAxis;v.region=v.region||{x:0-r.x,y:-3,width:r.x-3,height:r.height};var y=new yAxis(v);new Painter(this.canvas.id,y,p).paint(),n.restore(),n.save()},onOrentationChanged:function(t){function e(){return screen.width-40}var i=window.orientation;if(void 0!==i){setDebugMsg("orientation="+i+",getWidth="+e());var n=this,o=e();n.canvas.width=o;var s=n.klOptions,r=o-s.chartMargin.left-s.chartMargin.right;n.klOptions.volume.region.width=n.klOptions.priceLine.region.width=n.klOptions.region.width=r,n.controller=null,n.hasPaintPriceLine=!1,drawKL({start:n.dataRanges.start,to:n.dataRanges.to})}}};var painter,kType="",initialWidth=Math.min(screen.width,1024)-12;_Tip.prototype={show:function(t,e){var i=this.dataContext,n=this.canvas.painter;i&&(i.isNewQuote?n.fillTopText(i.data):n.fillTopText(i.data,i.index))},update:function(t,e){this.show(t,e)},hide:function(){var t=this.dataContext,e=this.canvas.painter;t&&e.fillTopText(t.data)}},minsChart.prototype={initWidth:function(t){this.canvas.width=t.initialWidth},paint:function(t){this.clear(),this.fillTopText(t),this.paintChart(t,this.options.minsChart),this.paintxAxis(),this.fillBottomText(t),this.paintVolume(t)},clearArr:[],clear:function(){for(var t=this.clearArr.legnth;t>0;t--)this.clearArr.pop().clearRect(0,0,1e3,1e3);this.ctx.clearRect(0,0,1e3,1e3)},paintVolume:function(t){var e=this.ctx,i=this.volume;e.beginPath(),e.rect(i.region.x,i.region.y,i.region.width,i.region.height),e.strokeStyle=i.borderColor,e.stroke(),line(e,i.region.x,i.region.y+i.region.height/2,i.region.x+i.region.width,i.region.y+i.region.height/2,i.splitLineColor),i.getDataLength=function(){return this.data.items.length},i.maxDotsCount=this.maxDotsCount;var n=new volumePainter(i),o=new Painter(this.canvas.id,n,{items:t.mins});o.paint(),this.clearArr.push(o);var s,r=o.maxVolume;r/1e6>1e3?(r/=1e6,s="百万"):(r/=1e4,s="万");var a=[r.toFixed(2),(r/2).toFixed(2),"("+s+")"],h=new yAxis(this.volume.yScaler);(o=new Painter(this.canvas.id,h,a)).paint(),this.clearArr.push(o)},fillBottomText:function(t){function e(t){return t>a.preClose?h.riseColor:t==a.preClose?h.normalColor:h.fallColor}if(this.bottomText){var i=this.ctx,n="高",o=this.bottomText;i.font=o.font,i.fillStyle=o.color;var s=i.measureText(n).width;i.fillText(n,o.region.x,o.region.y);var r=o.region.x+s,a=t.quote,h=this,l=e(a.highest),c=toMoney(a.highest);i.fillStyle=l,s=i.measureText(c).width,i.fillText(c,r,o.region.y),r+=s,n=" 低",i.fillStyle=o.color,s=i.measureText(n).width,i.fillText(n,r,o.region.y),r+=s;var g=e(a.lowest),d=toMoney(a.lowest);s=i.measureText(d).width,i.fillStyle=g,i.fillText(d,r,o.region.y),r+=s,i.fillStyle=o.color;var u=" 成交"+bigNumberToText(a.amount);i.fillText(u,r,o.region.y)}},paintxAxis:function(){var t=new xAxis(this.xScaler),e=new Painter(this.canvas.id,t,this.xScaler.data);e.paint(),this.clearArr.push(e)},paintChart:function(t){function e(t){Math.ceil((t-y.minsChart.region.x)*y.maxDotsCount/y.minsChart.region.width);return t}function i(e){var i,n,o=Math.ceil((e-y.minsChart.region.x)*y.maxDotsCount/y.minsChart.region.width);(o-=1)>=0&&o<t.mins.length?(i=t.mins[o].price,n=!1):(i=t.quote.price,n=!0),y.canvas.tip&&(y.canvas.tip.dataContext={data:t,isNewQuote:n,index:o});var s=i-v;return y.minsChart.region.y+y.minsChart.region.height/2-s*y.minsChart.region.height/2/f.maxDiff}var n=this.minsChart,o=this.minsChart.region,s=this.ctx;s.beginPath(),s.strokeStyle=n.borderColor,s.rect(o.x,o.y,o.width,o.height),s.stroke();for(var r=(this.minsChart.horizontalLineCount+this.minsChart.horizontalLineCount%2)/2,a=this.minsChart.horizontalLineCount+1,h=1;h<=this.minsChart.horizontalLineCount;h++){var l=h==r?n.middleLineColor:n.otherSplitLineColor,c=o.y+o.height*h/a;line(s,o.x,c,o.x+o.width,c,l)}a=this.minsChart.verticalLineCount+1;for(h=1;h<=this.minsChart.verticalLineCount;h++){var g=o.x+o.width*h/a;line(s,g,o.y,g,o.y+o.height,n.otherSplitLineColor)}var d={region:o,maxDotsCount:this.maxDotsCount,getDataLength:function(){return this.data.items.length},getItemValue:function(t){return t.price},middleValue:t.quote.preClose,lineColor:n.priceLineColor},u=new linePainter(d),f=new Painter(this.canvas.id,u,{items:t.mins});f.paint(n),this.clearArr.push(f);var p=this.minsChart.yScalerLeft,v=t.quote.preClose,y=this;p.color=function(t){return t>v?y.riseColor:t==v?y.normalColor:y.fallColor};for(var x=[],m=[],w=v-f.maxDiff,C=2*f.maxDiff/(this.minsChart.horizontalLineCount+1),h=this.minsChart.horizontalLineCount+1;h>=0;h--){var T=w+h*C;x.push(T.toFixed(2));var L=100*(T-v)/v;m.push(L.toFixed(2)+"%")}var b=new yAxis(p),P=new Painter(this.canvas.id,b,x);P.paint(),this.clearArr.push(P);var M=this.minsChart.yScalerRight;M.color=function(t){return"0.00%"==t?"black":"-"==t.charAt(0)?"green":"red"};var A=new yAxis(M),B=new Painter(this.canvas.id,A,m);if(B.paint(),this.clearArr.push(B),this.needPaintAvgPriceLine){var E=[],k=0,D=0;t.mins.each(function(t){k+=t.volume,D+=t.amount,E.push(D/k)}),d.lineColor=n.avgPriceLineColor,d.getItemValue=function(t){return t},u=new linePainter(d);var O=new Painter(this.canvas.id,u,{items:E});O.paint(),this.clearArr.push(O)}var S=(y=this).minsChart.region;_addCrossLinesAndTipEvents(this.canvas,{getCrossPoint:function(t){return{x:e(t.offsetX),y:i(t.offsetX)}},triggerEventRanges:{x:S.x,y:S.y,width:S.width,height:y.volume.region.y+y.volume.region.height-S.y},tipOptions:{getTipHtml:function(t){return null},position:{x:!1,y:!1}},crossLineOptions:{color:"black"}})},fillTopText:function(t,e){var i=t.quote,n=this.ctx,o=this.topText,s=o.region;n.clearRect(s.x,s.y,s.width,s.height);var r,a;void 0===e?(r=i.price,a=i.time):(r=t.mins[e].price,a=i.time.toString().substr(0,8)+getMinTime(e)),n.fillStyle=o.color,n.font=o.font,o.textBaseline&&(n.textBaseline=o.textBaseline);var h="最新"+toMoney(r),l=n.measureText(h).width;n.fillText(h,o.region.x,o.region.y);var c=r>i.preClose,g=(i.preClose,r<i.preClose),d=toMoney(r-i.preClose),u=(c?"↑":g?"↓":"")+d+"("+toMoney(100*d/i.preClose)+"%)",f=o.region.x+l;n.fillStyle=c?this.riseColor:g?this.fallColor:this.normalColor,n.fillText(u,f,o.region.y);var p=new String(a),v=p.charAt(8)+p.charAt(9)+":"+p.charAt(10)+p.charAt(11);n.fillStyle=o.color;var y=n.measureText(v).width;n.fillText(v,o.region.x+o.region.width-y,o.region.y)}};var storkHeight=160,newCharConfig={initialWidth:initialWidth=Math.min(screen.width,1024)-12,fallColor:"green",riseColor:"red",normalColor:"black",maxDotsCount:241,needPaintAvgPriceLine:!1,backgroundColor:"white",topText:{font:"12px 宋体",color:"black",region:{x:58.5,y:5.5,width:305,height:14},textBaseline:"top"},minsChart:{region:{x:0,y:21.5,width:initialWidth,height:storkHeight},priceLineColor:"#3F9DD5",avgPriceLineColor:"red",middleLineColor:"red",otherSplitLineColor:"lightgray",borderColor:"gray",horizontalLineCount:3,verticalLineCount:3,yScalerLeft:{font:"12px Arial",region:{x:.5,y:20,width:50.5,height:storkHeight},align:"right",fontHeight:9,textBaseline:"top"},yScalerRight:{font:"12px Arial",region:{x:initialWidth-40,y:20,width:40.5,height:storkHeight},align:"right",fontHeight:9,textBaseline:"top"}},xScaler:{font:"12px Arial",color:"black",region:{x:0,y:storkHeight+22,width:310,height:20},data:["09:30"]},volume:{region:{x:0,y:storkHeight+40,width:initialWidth,height:44},bar:{color:"green",width:2},borderColor:"lightgray",splitLineColor:"lightgray",yScaler:{font:"12px Arial",region:{x:.5,y:storkHeight+40,width:50.5,height:40},color:"black",align:"right",fontHeight:12,textBaseline:"top"}}};window.chart=null,window.fsdata=null;